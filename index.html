<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pepito's House - Ventas</title>
    <style>
        :root {
            --primary: #e63946; /* Rojo */
            --secondary: #ffb703; /* Amarillo/Dorado */
            --dark: #1d3557;
            --light: #f1faee;
        }

        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--light); margin: 0; padding: 0; }
        
        header { 
            background: white; padding: 15px; text-align: center; border-bottom: 4px solid var(--primary); 
            position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .logo { max-width: 120px; height: auto; }

        .about-link {
            position: absolute; top: 15px; right: 20px;
            text-decoration: none; color: var(--dark); font-size: 0.8em; font-weight: bold;
        }

        .container { max-width: 800px; margin: 20px auto; padding: 10px; }

        .product-card {
            background: white; border-radius: 10px; margin-bottom: 15px; padding: 15px;
            display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .product-info h3 { margin: 0; color: var(--primary); }
        .product-info p { margin: 5px 0; color: #666; font-size: 0.9em; }
        .price { font-weight: bold; color: var(--dark); font-size: 1.2em; }

        .btn-add {
            background: var(--secondary); border: none; padding: 8px 15px;
            border-radius: 5px; cursor: pointer; font-weight: bold;
        }

        /* Modal y Carrito */
        #cart-bar {
            position: fixed; bottom: 0; width: 100%; background: var(--primary);
            color: white; padding: 15px; text-align: center; cursor: pointer;
            display: none; font-weight: bold;
        }

        #modal-confirm {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); z-index: 1000;
        }

        .modal-content {
            background: white; margin: 10% auto; padding: 20px; width: 90%; max-width: 500px;
            border-radius: 10px; position: relative;
        }

        .close { position: absolute; right: 15px; top: 10px; cursor: pointer; font-size: 1.5em; }
        
        .bcv-box { background: #eee; padding: 10px; border-radius: 5px; margin: 10px 0; font-size: 0.9em; }

        #about-modal { display: none; /* Similar al de confirmaciÃ³n */ }
    </style>
</head>
<body>

    <header>
        <a href="#" class="about-link" onclick="showAbout()">Acerca de esta web</a>
        <img src="logo.jpg" alt="Pepito's House Logo" class="logo">
        <p>Pepito's House 251 - Â¡Sabor que atrapa!</p>
    </header>

    <div class="container" id="menu-container">
        <p style="text-align: center;">Cargando menÃº delicioso...</p>
    </div>

    <div id="cart-bar" onclick="openOrderModal()">
        ðŸ›’ Ver Pedido (<span id="cart-count">0</span> productos)
    </div>

    <div id="modal-confirm">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2>Confirmar Pedido</h2>
            <div id="order-list"></div>
            <div class="bcv-box">
                <strong>Tasa BCV hoy:</strong> <span id="bcv-rate">Cargando...</span> Bs.
            </div>
            <div id="delivery-info" style="margin-top:10px; font-weight: bold; color: var(--primary);"></div>
            <hr>
            <p><strong>Total en $: </strong> <span id="total-usd"></span></p>
            <p><strong>Total en Bs: </strong> <span id="total-bs"></span></p>
            <button class="btn-add" style="width: 100%; padding: 15px;" onclick="sendWhatsApp()">
                Confirmar y enviar por WhatsApp
            </button>
        </div>
    </div>

    <div id="about-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:2000;">
        <div class="modal-content">
            <span class="close" onclick="document.getElementById('about-modal').style.display='none'">&times;</span>
            <h3>Desarrollador</h3>
            <p><strong>Antonio Itriago</strong></p>
            <p>Analista, DiseÃ±ador y Desarrollador de Sistemas de InformaciÃ³n Computarizados.</p>
            <p>Contacto: <a href="https://wa.me/584122525407" target="_blank" style="color: green; text-decoration: none; font-weight: bold;">wa.me/584122525407</a></p>
        </div>
    </div>

    <script>
        const TSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRsTRhoswf3zopWO5PEusQsYdYglnUlWTX9HzFIvewpy4vED9fQbs9Z0V3EdQ-AGMGLlpmcs_LL_cP3/pub?gid=0&single=true&output=tsv';
        let cart = [];
        let bcvRate = 0;

        // 1. Obtener Tasa BCV (Usando un proxy/API para el promedio)
        async function fetchBCV() {
            try {
                // Nota: Usamos una API referencial simulada ya que BCV directo suele tener CORS. 
                // En producciÃ³n se usa un backend o un scrapper.
                const response = await fetch('https://ve.dolarapi.com/v1/dolares/oficial');
                const data = await response.json();
                bcvRate = data.promedio || data.oficial || 35.50; // Fallback
                document.getElementById('bcv-rate').innerText = bcvRate.toFixed(2);
            } catch (e) {
                console.error("Error tasa", e);
                bcvRate = 35.50; // Tasa manual de respaldo
            }
        }

        // 2. Cargar productos desde Google Sheet
        async function loadProducts() {
            const res = await fetch(TSV_URL);
            const text = await res.text();
            const rows = text.split('\n').slice(1); // Saltar cabecera
            const container = document.getElementById('menu-container');
            container.innerHTML = '';

            rows.forEach(row => {
                const cols = row.split('\t');
                if(cols.length < 4) return;
                const [id, name, price, currency, desc, cat] = cols;

                const card = document.createElement('div');
                card.className = 'product-card';
                card.innerHTML = `
                    <div class="product-info">
                        <h3>${name}</h3>
                        <p>${desc}</p>
                        <span class="price">$${parseFloat(price).toFixed(2)}</span>
                    </div>
                    <button class="btn-add" onclick="addToCart('${name}', ${price})">AGREGAR</button>
                `;
                container.appendChild(card);
            });
        }

        function addToCart(name, price) {
            cart.push({name, price});
            document.getElementById('cart-bar').style.display = 'block';
            document.getElementById('cart-count').innerText = cart.length;
        }

        function openOrderModal() {
            document.getElementById('modal-confirm').style.display = 'block';
            const listDiv = document.getElementById('order-list');
            listDiv.innerHTML = '';
            let total = 0;

            cart.forEach(item => {
                total += parseFloat(item.price);
                listDiv.innerHTML += `<p>â€¢ ${item.name} ($${item.price})</p>`;
            });

            // LÃ³gica de Delivery (Simulada segÃºn instrucciÃ³n: distancia x 2)
            // Como no tenemos GPS real en este cÃ³digo estÃ¡tico, estimamos una distancia base de 5km
            let distancia = 5; 
            let costoDelivery = distancia * 2;
            document.getElementById('delivery-info').innerText = `Costo de envÃ­o aproximado: $${costoDelivery.toFixed(2)}`;

            document.getElementById('total-usd').innerText = (total + costoDelivery).toFixed(2);
            document.getElementById('total-bs').innerText = ((total + costoDelivery) * bcvRate).toFixed(2);
            fetchBCV();
        }

        function sendWhatsApp() {
            let total = document.getElementById('total-usd').innerText;
            let totalBs = document.getElementById('total-bs').innerText;
            let deliveryMsg = document.getElementById('delivery-info').innerText;
            
            let message = `*Nuevo Pedido - Pepito's House*%0A---------------------------%0A`;
            cart.forEach(i => message += `- ${i.name} ($${i.price})%0A`);
            message += `%0A${deliveryMsg}%0A`;
            message += `---------------------------%0A`;
            message += `*Total DÃ³lares:* $${total}%0A`;
            message += `*Total BolÃ­vares (Tasa ${bcvRate}):* Bs. ${totalBs}%0A`;
            message += `%0AÂ¿Me confirman la disponibilidad?`;

            window.open(`https://wa.me/584122525407?text=${message}`);
        }

        function closeModal() { document.getElementById('modal-confirm').style.display = 'none'; }
        function showAbout() { document.getElementById('about-modal').style.display = 'block'; }

        // Inicializar
        loadProducts();
        fetchBCV();
    </script>
</body>
</html>
