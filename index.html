<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pepito's House - Pedidos</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    
    <style>
        :root {
            --primary: #f39c12; /* Naranja/Amarillo Pepito */
            --secondary: #2c3e50; /* Gris Oscuro/Negro House */
            --accent: #e67e22;
            --light: #ecf0f1;
            --dark: #1a1a1a;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Poppins', sans-serif; }

        body { background-color: #f4f4f4; color: var(--dark); }

        header {
            background: var(--dark);
            color: white;
            padding: 1rem;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo-img { height: 50px; border-radius: 5px; }

        .about-link {
            color: var(--primary);
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .container { max-width: 800px; margin: 20px auto; padding: 0 15px; }

        /* Cat√°logo */
        .product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 15px; }
        .product-card {
            background: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            text-align: center;
        }
        .product-card h3 { font-size: 1rem; margin-bottom: 5px; }
        .product-card .price { color: var(--accent); font-weight: bold; margin-bottom: 10px; }
        .qty-controls { display: flex; justify-content: center; align-items: center; gap: 10px; }
        .btn-qty { background: var(--primary); border: none; width: 25px; height: 25px; border-radius: 5px; cursor: pointer; color: white; }

        /* Carrito y Confirmaci√≥n */
        .cart-summary {
            background: white;
            margin-top: 30px;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            display: none;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background: white;
            padding: 25px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
        }

        .btn-order {
            background: #25d366;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            width: 100%;
            font-weight: bold;
            cursor: pointer;
            margin-top: 15px;
        }

        .info-section { margin-top: 20px; font-size: 0.8rem; color: #666; text-align: center; }
    </style>
</head>
<body>

<header>
    <img src="logo.jpg" alt="Pepito's House Logo" class="logo-img">
    <a href="#about" class="about-link" onclick="toggleAbout()">Acerca de esta web</a>
</header>

<div class="container">
    <h2 style="margin-bottom: 20px;">Men√∫ Principal</h2>
    <div id="product-list" class="product-grid">
        Cargando men√∫...
    </div>
</div>

<div id="confirm-modal" class="modal">
    <div class="modal-content">
        <h3>Confirmar Pedido</h3>
        <div id="order-details" style="margin: 15px 0;"></div>
        <hr>
        <div style="margin: 15px 0;">
            <label>¬øA cu√°ntos KM est√°s del negocio?</label>
            <input type="number" id="distancia" placeholder="Ej: 5" style="width: 100%; padding: 8px;">
        </div>
        <div id="final-prices" style="font-weight: bold; background: #f9f9f9; padding: 10px;"></div>
        <button class="btn-order" onclick="sendWhatsApp()">Enviar a WhatsApp</button>
        <button onclick="closeModal()" style="margin-top: 10px; border: none; background: none; color: red; cursor: pointer; width: 100%;">Cancelar</button>
    </div>
</div>

<div id="about-modal" class="modal">
    <div class="modal-content">
        <h3>Desarrollador</h3>
        <p><strong>Antonio Itriago</strong></p>
        <p>Analista, dise√±ador y desarrollador de sistemas de informaci√≥n computarizados.</p>
        <p style="margin-top: 15px;">Contacto directo:</p>
        <a href="https://wa.me/584122525407" target="_blank" style="text-decoration: none; color: #25d366; font-weight: bold;">wa.me/584122525407</a>
        <button onclick="toggleAbout()" style="display: block; margin-top: 20px; padding: 10px; width: 100%;">Cerrar</button>
    </div>
</div>

<div class="info-section">
    <p>Pepito's House 251 | Barquisimeto, Venezuela</p>
    <p>Tasa BCV hoy: <span id="tasa-val">Cargando...</span></p>
</div>

<div style="position: fixed; bottom: 20px; right: 20px;">
    <button onclick="openConfirm()" id="floating-cart" style="background: var(--primary); color: white; border: none; padding: 15px 25px; border-radius: 50px; box-shadow: 0 4px 10px rgba(0,0,0,0.3); cursor: pointer; display: none;">
        Ver Pedido (<span id="cart-count">0</span>)
    </button>
</div>

<script>
    const TSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRsTRhoswf3zopWO5PEusQsYdYglnUlWTX9HzFIvewpy4vED9fQbs9Z0V3EdQ-AGMGLlpmcs_LL_cP3/pub?gid=0&single=true&output=tsv';
    const WHATSAPP_NUM = "584122525407";
    let tasaBCV = 344.51; // Backup
    let products = [];
    let cart = {};

    // 1. Obtener Tasa BCV
    async function fetchBCV() {
        try {
            const res = await fetch('https://ve.dolarapi.com/v1/dolares/oficial');
            const data = await res.json();
            tasaBCV = data.promedio;
            document.getElementById('tasa-val').innerText = tasaBCV + " Bs.";
        } catch (e) {
            console.log("Usando tasa de respaldo");
            document.getElementById('tasa-val').innerText = tasaBCV + " Bs. (Ref)";
        }
    }

    // 2. Cargar Productos desde Google Sheets (TSV)
    async function loadProducts() {
        try {
            const response = await fetch(TSV_URL);
            const data = await response.text();
            const rows = data.split('\n').slice(1);
            
            const listEl = document.getElementById('product-list');
            listEl.innerHTML = '';

            rows.forEach(row => {
                const [id, name, price, currency, desc, cat] = row.split('\t');
                if(!id) return;
                
                const product = { id, name, price: parseFloat(price.replace(',','.')), currency, desc };
                products.push(product);

                const card = document.createElement('div');
                card.className = 'product-card';
                card.innerHTML = `
                    <h3>${name}</h3>
                    <p style="font-size:0.7rem; color: #777;">${desc}</p>
                    <p class="price">$${price}</p>
                    <div class="qty-controls">
                        <button class="btn-qty" onclick="updateQty('${id}', -1)">-</button>
                        <span id="qty-${id}">0</span>
                        <button class="btn-qty" onclick="updateQty('${id}', 1)">+</button>
                    </div>
                `;
                listEl.appendChild(card);
            });
        } catch (e) {
            document.getElementById('product-list').innerHTML = "Error cargando productos.";
        }
    }

    function updateQty(id, change) {
        cart[id] = (cart[id] || 0) + change;
        if(cart[id] <= 0) delete cart[id];
        
        document.getElementById(`qty-${id}`).innerText = cart[id] || 0;
        
        let totalItems = Object.values(cart).reduce((a, b) => a + b, 0);
        document.getElementById('floating-cart').style.display = totalItems > 0 ? 'block' : 'none';
        document.getElementById('cart-count').innerText = totalItems;
    }

    function openConfirm() {
        const orderDetails = document.getElementById('order-details');
        let html = '<ul>';
        let subtotalUSD = 0;

        for(const id in cart) {
            const p = products.find(x => x.id === id);
            const cost = p.price * cart[id];
            subtotalUSD += cost;
            html += `<li>${cart[id]}x ${p.name} - $${cost.toFixed(2)}</li>`;
        }
        html += '</ul>';
        orderDetails.innerHTML = html;
        
        // Listener para recalcular con delivery
        document.getElementById('distancia').oninput = () => {
            const dist = parseFloat(document.getElementById('distancia').value) || 0;
            const deliveryUSD = dist * 2;
            const totalUSD = subtotalUSD + deliveryUSD;
            const totalBS = totalUSD * tasaBCV;

            document.getElementById('final-prices').innerHTML = `
                <p>Delivery: $${deliveryUSD.toFixed(2)}</p>
                <p>TOTAL: $${totalUSD.toFixed(2)}</p>
                <p>TOTAL Bs: ${totalBS.toLocaleString('es-VE', {minimumFractionDigits: 2})} (Tasa: ${tasaBCV})</p>
            `;
        };
        
        document.getElementById('confirm-modal').style.display = 'flex';
        document.getElementById('distancia').dispatchEvent(new Event('input'));
    }

    function sendWhatsApp() {
        const dist = parseFloat(document.getElementById('distancia').value) || 0;
        const deliveryUSD = dist * 2;
        let subtotalUSD = 0;
        let msg = "Hola Pepito's House! Mi pedido:\n\n";

        for(const id in cart) {
            const p = products.find(x => x.id === id);
            msg += `‚Ä¢ ${cart[id]}x ${p.name} ($${(p.price * cart[id]).toFixed(2)})\n`;
            subtotalUSD += (p.price * cart[id]);
        }

        const totalUSD = subtotalUSD + deliveryUSD;
        const totalBS = totalUSD * tasaBCV;

        msg += `\nüõµ Delivery: $${deliveryUSD.toFixed(2)}`;
        msg += `\nüí∞ *TOTAL: $${totalUSD.toFixed(2)}*`;
        msg += `\nüáªüá™ *TOTAL Bs: ${totalBS.toLocaleString('es-VE', {minimumFractionDigits: 2})}*`;
        msg += `\n(Tasa BCV: ${tasaBCV})`;

        window.open(`https://wa.me/${WHATSAPP_NUM}?text=${encodeURIComponent(msg)}`);
    }

    function closeModal() { document.getElementById('confirm-modal').style.display = 'none'; }
    function toggleAbout() { 
        const el = document.getElementById('about-modal');
        el.style.display = el.style.display === 'flex' ? 'none' : 'flex';
    }

    window.onload = () => {
        fetchBCV();
        loadProducts();
    };
</script>

</body>
</html>
